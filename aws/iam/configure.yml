parameters:
  - name: secureFile
    displayName: Name of the secure file to download
    type: string
    default: $(AWS_CREDENTIALS_SECURE_FILE_NAME)

steps:
  - task: DownloadSecureFile@1
    displayName: Download AWS credentials
    inputs:
      secureFile: ${{ parameters.secureFile }}

  - task: PowerShell@2
    displayName: Configure AWS credentials
    inputs:
      targetType: inline
      script: |
        aws configure
      errorActionPreference: default
      showWarnings: true
      pwsh: true
    env:
      AWS_SHARED_CREDENTIALS_FILE: /home/vsts/work/_temp/${{ parameters.secureFile }}