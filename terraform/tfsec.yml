parameters:
  - name: version
    displayName: Terraform Static code Analyzer version to download and install
    type: string
    default: 0.58.6
  - name: commandOptions
    displayName: Command options
    type: string
  - name: workingDirectory
    displayName: Directory where Terraform files are located
    type: string
    default: $(Build.SourcesDirectory)/infrastructure

steps:
  - task: terraformstaticcodeanalyzer@1
    displayName: Install tfsec
    inputs:
      tfsecversion: ${{ parameters.version }}

  - task: PowerShell@2
    displayName: Run tfsec
    inputs:
      targetType: inline
      script: |
        tfsec . ${{ parameters.commandOptions }}
      errorActionPreference: stop
      showWarnings: true
      pwsh: true
      workingDirectory: ${{ parameters.workingDirectory }}

